# Puppeteer vs pdfmake æ–¹æ¡ˆå¯¹æ¯”

## ğŸ¯ æ ¸å¿ƒç»“è®ºï¼šä¸ºä»€ä¹ˆå¿…é¡»é€‰æ‹© Puppeteer

### pdfmake çš„è‡´å‘½é—®é¢˜

1. **Browser ç«¯ pdfmake**ï¼š
   - âŒ **å­—ä½“åŠ è½½é—®é¢˜**ï¼šéœ€æ‰‹åŠ¨é…ç½® VFSï¼Œå…¨çƒè¯­è¨€æ”¯æŒå›°éš¾
   - âŒ ä¸­æ—¥éŸ©ã€é˜¿æ‹‰ä¼¯æ–‡ç­‰éœ€è¦é¢å¤–é…ç½®
   - âŒ å­—ä½“æ–‡ä»¶ä½“ç§¯å¤§ï¼Œæµè§ˆå™¨åŠ è½½æ…¢

2. **Node ç«¯ pdfmake**ï¼š
   - âŒ **æ•°å­¦å…¬å¼æ¸²æŸ“å·®**ï¼šåªèƒ½ç”¨ SVG
   - âŒ **è¢«è¿«ä½¿ç”¨ MathJax**ï¼šæ…¢ã€æ¸²æŸ“è´¨é‡ä¸å¦‚ KaTeX
   - âŒ foreignObject ä¸æ”¯æŒï¼Œå¿…é¡»è½¬å›¾ç‰‡
   - âŒ è½¬å›¾ç‰‡æ–¹æ¡ˆå¤æ‚ä¸”æ•ˆæœå·®

### Puppeteer çš„æ ¸å¿ƒä¼˜åŠ¿

**æœåŠ¡å™¨ç«¯ API åœºæ™¯ï¼ŒåŒ…å¤§å°ä¸æ˜¯é—®é¢˜ï¼**

1. âœ… **å®Œç¾å­—ä½“æ”¯æŒ**ï¼šChromium å†…ç½®å…¨çƒè¯­è¨€å­—ä½“
2. âœ… **KaTeX å®Œç¾æ¸²æŸ“**ï¼šå¿«é€Ÿã€å‡†ç¡®ã€ç¾è§‚
3. âœ… **ç®€å•é«˜æ•ˆ**ï¼šMarkdown â†’ HTML â†’ PDF
4. âœ… **æ ‡å‡†æŠ€æœ¯æ ˆ**ï¼šHTML/CSSï¼Œæ˜“ç»´æŠ¤
5. âœ… **300MB å¯¹æœåŠ¡å™¨ä¸æ˜¯é—®é¢˜**

---

## ğŸ“Š ä¸¤ç§æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ 1: pdfmake + KaTeX (å½“å‰å®ç°)

**ä¼˜ç‚¹:**
- âœ… åŒ…ä½“ç§¯å°ï¼ˆæ— éœ€æµè§ˆå™¨å¼•æ“ï¼‰
- âœ… æ€§èƒ½å¥½ï¼Œå†…å­˜å ç”¨ä½
- âœ… å¯åŠ¨å¿«é€Ÿ
- âœ… é€‚åˆæœåŠ¡å™¨ç«¯å¤§è§„æ¨¡å¹¶å‘ç”Ÿæˆ
- âœ… å¯ç²¾ç»†æ§åˆ¶ PDF å…ƒç´ å®šä½

**ç¼ºç‚¹:**
- âŒ æ•°å­¦å…¬å¼éœ€è¦è½¬æ¢ä¸ºå›¾ç‰‡ï¼ˆå¤æ‚ï¼‰
- âŒ CSS æ ·å¼æ”¯æŒæœ‰é™ï¼ˆéœ€è¦è½¬æ¢ä¸º pdfmake é…ç½®å¯¹è±¡ï¼‰
- âŒ ä¸æ”¯æŒå®Œæ•´çš„ Web æ ‡å‡†
- âŒ è°ƒè¯•å›°éš¾ï¼ˆæŠ½è±¡å±‚æ¬¡å¤šï¼‰

### æ–¹æ¡ˆ 2: Puppeteer + KaTeX (æ–°æ–¹æ¡ˆ)

**ä¼˜ç‚¹:**
- âœ… **æ•°å­¦å…¬å¼å®Œç¾æ¸²æŸ“**ï¼ˆä½¿ç”¨åŸç”Ÿ KaTeXï¼‰
- âœ… **æ”¯æŒå®Œæ•´ CSS æ ·å¼**ï¼ˆæ ‡å‡† Web æŠ€æœ¯ï¼‰
- âœ… å®ç°ç®€å•ç›´æ¥ï¼ˆMarkdown â†’ HTML â†’ PDFï¼‰
- âœ… æ‰€è§å³æ‰€å¾—ï¼ˆæµè§ˆå™¨æ¸²æŸ“ï¼‰
- âœ… è°ƒè¯•æ–¹ä¾¿ï¼ˆä½¿ç”¨æµè§ˆå™¨å¼€å‘å·¥å…·ï¼‰
- âœ… æ”¯æŒå¤æ‚å¸ƒå±€å’Œæ ·å¼

**ç¼ºç‚¹:**
- âŒ åŒ…ä½“ç§¯å¤§ï¼ˆ~300MBï¼ŒåŒ…å« Chromiumï¼‰
- âŒ å†…å­˜å ç”¨è¾ƒé«˜ï¼ˆéœ€è¦å¯åŠ¨æµè§ˆå™¨å®ä¾‹ï¼‰
- âŒ å¯åŠ¨è¾ƒæ…¢ï¼ˆé¦–æ¬¡éœ€è¦ä¸‹è½½ Chromiumï¼‰
- âŒ ä¸é€‚åˆæé«˜å¹¶å‘åœºæ™¯

---

## ğŸ¯ ä½¿ç”¨å»ºè®®

### ä½¿ç”¨ Puppeteer æ–¹æ¡ˆï¼Œå¦‚æœï¼š
1. **æ•°å­¦å…¬å¼å¾ˆå¤š**ï¼Œéœ€è¦å®Œç¾æ¸²æŸ“
2. å¯¹ PDF æ ·å¼è¦æ±‚é«˜
3. ç†Ÿæ‚‰ HTML/CSSï¼Œå¸Œæœ›ä½¿ç”¨æ ‡å‡† Web æŠ€æœ¯
4. ç”Ÿæˆé¢‘ç‡ä¸é«˜ï¼ˆå¦‚ï¼šç”¨æˆ·æŒ‰éœ€ç”Ÿæˆï¼‰
5. æœåŠ¡å™¨èµ„æºå……è¶³

### ä½¿ç”¨ pdfmake æ–¹æ¡ˆï¼Œå¦‚æœï¼š
1. **æ•°å­¦å…¬å¼è¾ƒå°‘æˆ–æ²¡æœ‰**
2. éœ€è¦æè‡´æ€§èƒ½å’Œä½å†…å­˜å ç”¨
3. æœåŠ¡å™¨ç¯å¢ƒå—é™ï¼ˆå¦‚ï¼šæ— æ³•å®‰è£… Chromiumï¼‰
4. éœ€è¦å¤§è§„æ¨¡å¹¶å‘ç”Ÿæˆï¼ˆå¦‚ï¼šæ‰¹é‡æŠ¥è¡¨ï¼‰
5. Docker å®¹å™¨ç¯å¢ƒå¯¹ä½“ç§¯æ•æ„Ÿ

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### Puppeteer æ–¹æ¡ˆ

\`\`\`typescript
import { markdownToPdfWithPuppeteer } from './pdf-generator-puppeteer';

const markdown = `
# æ•°å­¦å…¬å¼æµ‹è¯•

è´¨èƒ½æ–¹ç¨‹ï¼š$E = mc^2$

ç§¯åˆ†å…¬å¼ï¼š
$$
\\int_{0}^{\\infty} e^{-x^2} dx = \\frac{\\sqrt{\\pi}}{2}
$$
`;

await markdownToPdfWithPuppeteer(markdown, 'output.pdf', {
  pageFormat: 'A4',
  margin: { top: '20mm', right: '15mm', bottom: '20mm', left: '15mm' }
});
\`\`\`

### pdfmake æ–¹æ¡ˆ

\`\`\`typescript
import { unified } from 'unified';
import remarkParse from 'remark-parse';
import remarkMath from 'remark-math';
import remarkGfm from 'remark-gfm';
import pdf, { preprocessMathFormulas } from './lib/node.mjs';

const processor = unified()
  .use(remarkParse)
  .use(remarkMath)
  .use(remarkGfm)
  .use(pdf, { output: 'buffer' });

const markdown = `# æµ‹è¯•æ–‡æ¡£`;
const preprocessed = preprocessMathFormulas(markdown);
const doc = await processor.process(preprocessed);
const buffer = await doc.result;

fs.writeFileSync('output.pdf', buffer);
\`\`\`

---

## ğŸ’¡ æ··åˆæ–¹æ¡ˆ

å¯¹äºå®é™…é¡¹ç›®ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚æ··åˆä½¿ç”¨ï¼š

1. **ç®€å•æ–‡æ¡£** â†’ pdfmakeï¼ˆå¿«é€Ÿã€è½»é‡ï¼‰
2. **æ•°å­¦å…¬å¼å¤šçš„æ–‡æ¡£** â†’ Puppeteerï¼ˆå®Œç¾æ¸²æŸ“ï¼‰
3. **æ‰¹é‡ç”Ÿæˆ** â†’ pdfmakeï¼ˆæ€§èƒ½ä¼˜å…ˆï¼‰
4. **ç”¨æˆ·ç•Œé¢å¯¼å‡º** â†’ Puppeteerï¼ˆæ‰€è§å³æ‰€å¾—ï¼‰

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•

### æµ‹è¯• Puppeteer æ–¹æ¡ˆ
\`\`\`bash
npx tsx pdf-generator-puppeteer.ts
# ç”Ÿæˆ: example-puppeteer-output.pdf
\`\`\`

### æµ‹è¯• pdfmake æ–¹æ¡ˆ
\`\`\`bash
npx tsx example.ts
# ç”Ÿæˆ: example-output.pdf
\`\`\`

---

## ğŸ“¦ ä¾èµ–å¯¹æ¯”

### Puppeteer æ–¹æ¡ˆ
\`\`\`json
{
  "puppeteer": "^23.x",      // ~300MB (åŒ…å« Chromium)
  "remark-rehype": "^10.x",
  "rehype-katex": "^7.x",
  "rehype-stringify": "^9.x"
}
\`\`\`

### pdfmake æ–¹æ¡ˆ
\`\`\`json
{
  "pdfmake": "^0.2.x",       // ~2MB
  "katex": "^0.16.x",        // ~5MB
  "jsdom": "^27.x",          // ~10MB
  "html-to-image": "^1.x"    // ~1MB
}
\`\`\`

---

## ğŸ‰ ç»“è®º

### æœåŠ¡å™¨ç«¯ API åœºæ™¯çš„å”¯ä¸€æ­£ç¡®é€‰æ‹©ï¼šPuppeteer

**ç†ç”±ï¼š**

1. **å­—ä½“é—®é¢˜**
   - pdfmakeï¼šéœ€è¦æ‰‹åŠ¨é…ç½®å…¨çƒè¯­è¨€å­—ä½“ VFSï¼ˆå‡ ä¹ä¸å¯èƒ½ï¼‰
   - Puppeteerï¼šChromium å†…ç½®ï¼Œå¼€ç®±å³ç”¨ âœ…

2. **æ•°å­¦å…¬å¼**
   - pdfmakeï¼šåªèƒ½ SVG + MathJaxï¼ˆæ…¢ã€è´¨é‡å·®ï¼‰
   - Puppeteerï¼šåŸç”Ÿ KaTeXï¼ˆå¿«ã€å‡†ç¡®ã€ç¾è§‚ï¼‰ âœ…

3. **åŒ…å¤§å°**
   - pdfmakeï¼š~20MB
   - Puppeteerï¼š~300MB
   - **æœåŠ¡å™¨ç«¯éƒ¨ç½²ï¼Œ300MB å®Œå…¨å¯æ¥å—ï¼** âœ…

4. **å¼€å‘ç»´æŠ¤**
   - pdfmakeï¼šå¤æ‚çš„é…ç½®å¯¹è±¡ï¼Œ1000+ è¡Œè½¬æ¢ä»£ç 
   - Puppeteerï¼šæ ‡å‡† HTML/CSSï¼Œ<300 è¡Œä»£ç  âœ…

**ç»“è®ºï¼šå¯¹äºéœ€è¦å…¨çƒè¯­è¨€æ”¯æŒå’Œå®Œç¾æ•°å­¦å…¬å¼æ¸²æŸ“çš„æœåŠ¡å™¨ç«¯ APIï¼ŒPuppeteer æ˜¯å”¯ä¸€åˆç†çš„é€‰æ‹©ï¼**

---

## ğŸš€ éªŒè¯æ•ˆæœ

æŸ¥çœ‹ç”Ÿæˆçš„æµ‹è¯•æ–‡ä»¶ï¼š
- `example-puppeteer-output.pdf` - åŸºç¡€ç¤ºä¾‹
- `test-multilang-katex-output.pdf` - å¤šè¯­è¨€ + æ•°å­¦å…¬å¼ï¼ˆä¸­æ—¥éŸ©è‹±ä¿„é˜¿æ‹‰ä¼¯æ–‡ï¼‰

**æ¨èï¼šä½¿ç”¨ Puppeteer æ–¹æ¡ˆï¼** ğŸ¯

